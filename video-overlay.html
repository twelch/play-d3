<!DOCTYPE html>
<html>
    <meta charset=utf-8>
<head>
    <meta name="description" content="D3.js v4, transition, color, location" />
    <style>
      body {
        margin: 0;
      }
      .video-box {
        width: 100%;
        object-fit: contain;
        position: relative;
      }
      #overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
        top: 0;
        left: 0;
        z-index: 1000;
        pointer-events: none;
        background-color: gray;
        opacity: 0.75
      }
      #video {
        width: 100%;
        object-fit: contain;
      }
    </style>
</head>

<body>
    <div class='video-box'>
      <svg id="overlay"></svg>
      <video id="video">
        <source src="https://ia800209.us.archive.org/24/items/WildlifeSampleVideo/Wildlife.mp4" type="video/mp4">
        <track  kind="captions" srclang="en-us" label="English" default>
      </video>    
    </div>
    <script src="http://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.js"></script>
    <script>

    var video = document.querySelector('video');
    var videoEl = document.getElementById('video')

    // Autoplay
    videoEl.addEventListener('canplaythrough', function() {
      video.play()
    })
    if (video.readyState === 4) {
      video.play()
    }

    var tracks = video.textTracks;
    var track = tracks[0];

    // Setup event handler
    track.oncuechange = function () {
      var cue = this.activeCues[0]
      if (cue) {
        update(JSON.parse(cue.text))
      }
    }

    // Add event cues
    track.addCue(new VTTCue(1, 2, '[{"uuid": "a", "x": 10, "y": 10, "height": 20, "width": 40, "fill": "red"},{"uuid": "b", "x": 10, "y": 40, "height": 20, "width": 40, "fill": "blue"}]'));
    track.addCue(new VTTCue(2, 3, '[{"uuid": "a", "x": 35, "y": 20, "height": 20, "width": 40, "fill": "red"},{"uuid": "b", "x": 36, "y": 50, "height": 20, "width": 40, "fill": "blue"}]'));
    track.addCue(new VTTCue(3, 4, '[{"uuid": "a", "x": 47, "y": 15, "height": 20, "width": 40, "fill": "red"},{"uuid": "b", "x": 55, "y": 55, "height": 20, "width": 40, "fill": "blue"}]'));
    track.addCue(new VTTCue(4, 5, '[{"uuid": "a", "x": 97, "y": 20, "height": 20, "width": 40, "fill": "red"},{"uuid": "c", "x": 10, "y": 40, "height": 25, "width": 60, "fill": "green"}]'));
    track.addCue(new VTTCue(5, 6, '[{"uuid": "a", "x": 117, "y": 18, "height": 20, "width": 40, "fill": "red"},{"uuid": "c", "x": 54, "y": 45, "height": 25, "width": 60, "fill": "green"}]'));
    track.addCue(new VTTCue(6, 7, '[{"uuid": "a", "x": 100, "y": 18, "height": 20, "width": 40, "fill": "red"},{"uuid": "c", "x": 84, "y": 48, "height": 25, "width": 60, "fill": "green"}]'));

    var curEvent = 0

    function update(data) {
      var boxes = d3.select('#overlay')
        .selectAll('rect')
        .data(data, function(d) {
          return d.uuid;
        });

      // Transition existing boxes
      boxes.transition()
        .duration(200)
        .attr('x', function(d) { return d.x })
        .attr('y', function(d) { return d.y })
        .attr('height', function(d) { return d.height })
        .attr('width', function(d) { return d.width })
        .attr('fill', function(d) { return d.fill })

      // Append new boxes
      boxes.enter()
        .append('rect')
        .attr('x', function(d) { return d.x })
        .attr('y', function(d) { return d.y })
        .attr('height', function(d) { return d.height })
        .attr('width', function(d) { return d.width })
        .attr('fill', function(d) { return d.fill })
        .style('opacity', 0)
        .transition()
        .duration(300)
        .style('opacity', 1)

      boxes.exit()
        .style('opacity', 1)
        .transition()
        .duration(300)
        .style('opacity', 0)
        .remove()
    }

    </script>
</body>
</html>